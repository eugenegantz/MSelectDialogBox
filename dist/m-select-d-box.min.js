!function(a){"use strict";var b=function(a){this.init(a)};b.prototype={instances:[],_coldInit:0,get:function(a,b,c){return"string"==typeof a?(a=a.toLowerCase(),(c||void 0===c)&&(this.trigger("get"),this.trigger("get:"+a)),this._props[a]):void 0},set:function(a,b,c,d){if(!a)return this;if("object"==typeof a){var e=Object.create(null);for(var f in a)Object.prototype.hasOwnProperty.call(a,f)&&(e[f]=this.set(f,a[f],null,d));return this}if("string"!=typeof a)return this;a=a.toLowerCase();var g={value:b};return"undefined"==typeof d&&(d=!0),d&&(this.trigger("set",g),this.trigger("set:"+a,g),this.trigger("beforeSet:"+a,g)),this._props[a]=b,d&&this.trigger("afterSet:"+a,g),this},getInstances:function(b){if(!arguments.length)return this.instances;"object"!=typeof b&&(b=Object.create(null));var c,d=[],e=a.inArray(typeof b.name,["string","number"])>-1?b.name:null;for(c=0;c<this.instances.length;c++)(null===e||this.instances[c].get("name",void 0,!1)==e)&&d.push(this.instances[c]);return d},removeInstances:function(b){if("object"!=typeof b)return this;var c,d="string"!=typeof b.name?null:b.name,e=[];for(c=0;c<this.instances.length;c++)this.instances[c].get("name",void 0,!1)!=d?e.push(this.instances[c]):a(this.instances[c].get("dbox",void 0,!1)).detach();return this.instances=e,this},_targetEvents:{click:{name:"click",event:"click"},keydown:{name:"keydown",event:"keydown",dbox_input:!0},keyup:{name:"keyup",event:"keyup",dbox_input:!0},hover:{name:"hover",event:"hover"},focus:{name:"focus",event:"focus"},focusout:{name:"focusout",event:"focusout"},change:{name:"change",event:"change"}},_eventCheckInputEmpty:function(a){this.fx.isTextInput(a.target)&&!a.target.value.trim()&&this.trigger("input:empty",a)},_eventDefaultInputEmpty:function(){this.deselectAll()},_eventSetList:function(){var a=arguments[1];this.set("list",a.value,null,!1),this.reInitList()},_eventWindowResize:function(){for(var a=0;a<this.instances.length;a++)this.instances[a].isActive()&&(this.instances[a]._calcListContainerHeight(),this.instances[a].calcPosition())},_eventDefaultKeyUp:function(b){var c=this,d=c.get("target",null,!1),e=c.get("dbox_input",null,!1),f=b.keyCode,g=(c.get("list",null,!1),c.get("dbox",null,!1),b.currentTarget),h=[37,38,39,40,9,13,18,17,16,20,27];c._isDBoxInput(b.target)?c.fx.isTextInput(d)&&(d.value=e.value):g==d&&-1==a.inArray(b.keyCode,h)&&(e.value=d.value),clearTimeout(c._timers.autoComplete),c._timers.autoComplete=setTimeout(function(){var b,d,e;if(c.get("autoComplete",null,!1)&&a.inArray(f,h)<0&&(b=g.value.toLowerCase().split(/[;,]/gi),b=b[b.length-1],c.unhoverAllOpt(),c.applyAutoComplete(b),!c._isMobileState()&&c.calcPosition()),c.get("multiple",null,!1)&&8==f){for(b=c.fx.trim(g.value," ;,").split(/[,;]/gi),e=c.getSelectedKeys(),d=0;d<b.length;d++)b[d]=b[d].trim();c._selectByLabel(b,!0),c.applySelectedToList(c._getItemsByID(e.concat(c.getSelectedKeys())))}},c.get("autoCompleteTimeoutDelay",null,!1))},_eventDefaultKeyDownMultipleFalse:function(b){var c=this,d=this.get("selectedCache",null,!1),e=d[Object.keys(d)[0]],f=c.get("target",null,!1);if(!c.get("multiple",null,!1))if(a.inArray(b.keyCode,[37,39,9,18,17,16,20,27])>-1);else if(13==b.keyCode)c.isActive()?c.close():(c.open(),c._eventFocus.call(f,c,b));else if(a.inArray(b.keyCode,[38,39,40])>-1){if(!c.isActive())return;if(e)if(38==b.keyCode)e=c.selectPrevVisibleItem(e);else{if(40!=b.keyCode)return;e=c.selectNextVisibleItem(e)}else e=c.selectPrevVisibleItem(c.getFirstVisibleItem());c.calcScrollBarPosition(),b.listItem=e,c.trigger("select",b)}},_eventDefaultKeyDownMultipleTrue:function(b){var c,d=this,e=(d.get("list",null,!1),d.getHoveredItems()[0]);if(d.get("multiple")){if(a.inArray(b.keyCode,[37,39,9,18,17,16,20,27])>-1);else{if(13==b.keyCode){if(!e)return;return c=d.getSelectedKeys(),e.selected?d._deselectByID(e.id):d._selectByID(e.id),c=c.concat(d.getSelectedKeys()),d.applySelectedToInput(),d.applySelectedToList(d._getItemsByID(c)),b.listItem=e,void d.trigger("select",b)}(38==b.keyCode||40==b.keyCode)&&(e?(38==b.keyCode&&d.hoverPrevVisibleItem(e),40==b.keyCode&&d.hoverNextVisibleItem(e)):d.hoverItem(d.getFirstVisibleItem()))}d.calcScrollBarPosition()}},_eventFocus:function(b,c){var d,e,f,g=this,h=g.getSelectedKeys(),i=g.get("list",null,!1),j=(g.get("dbox",null,!1),c.currentTarget||(this instanceof Element?this:null));if(g.open(),g.fx.isTextInput(j))if(f=j.getAttribute("data-msdb-value"),f&&(f=f.trim()),f){for(f=f.split(/[;,]/gi),d=0;d<f.length;d++)f[d]=f[d].trim();g._selectByValue(f,!0)}else{for(e=g.fx.trim(j.value,",; ").split(/[;,]/gi),d=0;d<e.length;d++)e[d]=e[d].trim();g._selectByLabel(e,!0)}g.unhideAllOpt(),Object.keys(i).forEach(function(b){var c=i[b];"undefined"!=typeof j.type&&a.inArray(j.type.toLowerCase(),["submit","button"])>-1||a.inArray(j.tagName.toLowerCase(),["submit","body","select"])>-1||g.unhoverItem(c)}),h=h.concat(g.getSelectedKeys()),!g.get("freeWrite")&&g.applySelectedToInput(),g.applySelectedToList(g._getItemsByID(h)),g.calcScrollBarPosition(),g._calcListContainerHeight()},_onFocusOut:function(){this.get("multiple",null,!1)&&this.applySelectedToInput()},_initEvents:function(b){var c,d=(a("body").get(0),this),e={};this.events=Object.create(null);for(c in b)b.hasOwnProperty(c)&&"function"==typeof b[c]&&(e[c.replace(/^on/,"")]=b[c]);for(c in b.events)b.events.hasOwnProperty(c)&&"function"==typeof b.events[c]&&(e[c]=b.events[c]);for(c in e)e.hasOwnProperty(c)&&this.on(c,e[c]);this.on("keyup",function(a,b){d._eventCheckInputEmpty(b)}),this.on("change",function(a,b){d._eventCheckInputEmpty(b)}),this.on("input:empty",d._eventDefaultInputEmpty),this.on("focus",d._eventFocus.bind(d)),this.on("click",d._eventFocus.bind(d)),this.on("focusout",function(a,b){return b.relatedTarget?void(d._isDBoxInput(b.relatedTarget)||d._isDBoxElement(b.relatedTarget)||d._isTargetElement(b.relatedTarget)||d.close()):void(d._timers.focusoutInputs=setTimeout(function(){d.close()},d.get("focusOutInputsTimeoutDelay",null,!1)))}),this.on("focusout",this._onFocusOut),a(this.get("dbox_input")).bind("focus",function(){clearTimeout(d._timers.focusoutInputs)}),this.on("afterSet:list",this._eventSetList),d._isColdInit()&&window.addEventListener("resize",d._eventWindowResize.bind(d),!1)},_deactivateInstances:function(a){for(var b=0;b<this.instances.length;b++)this.instances[b]._isDBoxElement(a.target)||this.instances[b]._isTargetElement(a.target)||this.instances[b].isActive()&&this.instances[b].close()},_initTarget:function(){var b=this.get("target");b&&"object"==typeof b&&("string"==typeof b?(b=a(b).get(0),this.set("target",b,null,!1)):b instanceof Element?this.set("target",b,null,!1):b instanceof a&&this.set(b.get(0),null,!1))},trigger:function(b,c){if("string"!=typeof b)return this;if(b=b.toLowerCase(),"object"==typeof this.events[b]&&Array.isArray(this.events[b])){!c||c instanceof(window.CustomEvent||Function)==0&&c instanceof(window.Event||Function)==0&&c instanceof a.Event==0?c=a.Event(b,c):c instanceof a.Event==0&&(c=a.Event(b,c));for(var d=this.events[b],e=0;e<d.length;e++)"function"==typeof d[e]&&d[e].call(this,this,c)}return this},on:function(b,c){var d=this,e=this.get("target",null,!1),f=this.get("dbox_input",null,!1);return"string"!=typeof b||"function"!=typeof c?this:(b=b.toLowerCase(),"object"==typeof this.events[b]&&Array.isArray(this.events[b])||(this.events[b]=[],this._targetEvents.hasOwnProperty(b)&&(a(e).bind(this._targetEvents[b].event,function(a){d.trigger(b,a)},null),this._targetEvents[b].dbox_input&&a(f).bind(this._targetEvents[b].event,function(a){d.trigger(b,a)},null))),this.events[b].push(c),this)},detectLanguage:function(){var a=(navigator.languages||[])[0]||navigator.language||navigator.systemLanguage||navigator.userLanguage||navigator.browserLanguage||"en-US";return a.split(/[-_]/gi)[0]},_lastLang:"",_texts:{".m-select-d-box-fade__outside-click-label-text":{ru:"Нажмите чтобы закрыть",en:"Tap to close"},".m-select-d-box__search-input":{ru:"Поиск",en:"Search"}},getText:function(a,b){return!b&&(b=this.get("language")||this.detectLanguage()),(this._texts[a]||{})[b]||""},setText:function(a,c,d){var e=!0,f=this instanceof b?!(e=!1)&&Object.getPrototypeOf(this):this;return!f._texts[c]&&(f._texts[c]={}),!d&&(d=!e&&this.get("language")||this.detectLanguage()),f._texts[c][d]=a,this},_globalElems:{fade:void 0},_globalStyles:function(){var a={".m-select-d-box":{position:"absolute",display:"block",width:"168px",padding:"8px",height:"auto","box-shadow":"0 10px 20px -5px rgba(0, 0, 0, 0.4)","background-color":"#FFF","border-radius":"3px",border:"1px solid #e6e6e6"},".m-select-d-box:after":{content:"''",position:"absolute","border-left":"10px solid transparent","border-right":"9px solid transparent","border-bottom":"10px solid white",top:"-10px",left:"50%","margin-left":"-10px"},".m-select-d-box:before":{content:"''",position:"absolute","border-left":"11px solid transparent","border-right":"11px solid transparent","border-bottom":"11px solid #e6e6e6",top:"-11px",left:"50%","margin-left":"-11px"},".m-select-d-box_bottom:after":{content:"''",position:"absolute","border-left":"10px solid transparent","border-right":"9px solid transparent","border-bottom":"none","border-top":"10px solid white",top:"auto",bottom:"-10px",left:"50%","margin-left":"-10px"},".m-select-d-box_bottom:before":{border:"none"},".m-select-d-box__list-container":{position:"relative",margin:"0px",padding:"0px","max-height":"200px","overflow-x":"hidden"},".m-select-d-box__list-item":{position:"relative",padding:"5px","background-color":"none",color:"black",display:"block","line-height":"100%",cursor:"pointer","font-size":"12px"},".m-select-d-box__list-item:hover, .m-select-d-box__list-item_hover":{"background-color":"#e6e6e6"},".m-select-d-box__list-item_selected":{"background-color":"#C40056",color:"white"},".m-select-d-box__list-item_selected:hover, .m-select-d-box__list-item_selected.m-select-d-box__list-item_hover":{"background-color":"#DB2277"},".m-select-d-box__list-item_selected:before":{content:"':: '"},".m-select-d-box__list-item:active, .m-select-d-box__list-item_selected:active":{"background-color":"#b80000",color:"white"},".m-select-d-box__list-item_hidden":{display:"none"},".m-select-d-box__search-input":{border:"1px solid #a2a2a2",width:"100%","line-height":"100%","font-size":"14px","border-width":"0 0 2px 0",padding:"8px","box-sizing":"border-box"},".m-select-d-box__search-input-container":{"margin-bottom":"12px",display:"none"},".m-select-d-box__search-input-container_active":{display:"block"},".m-select-d-box-fade":{display:"none",width:0,height:0,left:0,top:0},".m-select-d-box-fade__outside-click-label":{position:"absolute",width:"100%",bottom:0,padding:"10px",background:"black",color:"white","text-align":"center","font-size":"1em","box-sizing":"border-box"},".m-select-d-box-fade__outside-click-label-text":{},".m-select-d-box-fade__outside-click-label-icon":{position:"relative","border-radius":"50%","margin-right":"5px",border:"2px solid white",display:"inline-block",height:"16px",width:"16px","vertical-align":"middle"},".m-select-d-box-fade__outside-click-label-icon:after":{content:"''",position:"absolute",top:"50%",left:"50%",height:"80%",width:"2px",transform:"rotate(45deg)","margin-left":"-1px","margin-top":"-40%",background:"white"},".m-select-d-box-fade__outside-click-label-icon:before":{content:"''",position:"absolute",top:"50%",left:"50%",height:"80%",width:"2px",transform:"rotate(-45deg)","margin-left":"-1px","margin-top":"-40%",background:"white"},"@media screen and (max-width: 640px)":{".m-select-d-box":{position:"fixed",width:"80% !important",padding:"0 !important",left:"10% !important",top:"5% !important","max-height":"90%","box-shadow":"none","border-radius":"0px","box-sizing":"border-box"},".m-select-d-box:after":{content:"none"},".m-select-d-box__list-container":{"max-height":"none"},".m-select-d-box__list-item":{padding:"1em","font-size":"1em"},".m-select-d-box__search-input-container":{"margin-bottom":"12px",display:"block"},".m-select-d-box__search-input":{"line-height":"1em","font-size":"1em",padding:"1em"},".m-select-d-box-fade":{width:"100%",height:"100%",position:"fixed",left:0,top:0,"background-color":"rgba(0, 0, 0, 0.33)",display:"block"}},"@media screen and (max-width: 740px)":{"@media screen and (min-resolution: 2dppx)":{}},".m-select-d-box_hidden":{display:"none"}};return a["@media screen and (max-width: 740px)"]["@media screen and (min-resolution: 2dppx)"]=a["@media screen and (max-width: 640px)"],a}(),_initStyles:function(){return a("#m-select-d-box-style").length||this._buildStyles(),this},_buildStyles:function(){var b=a("body"),c=function(a){var b,d,e="";for(b in a)if(Object.prototype.hasOwnProperty.call(a,b))if(b.match(/^@media/))e+=b+" {"+c(a[b])+"} ";else{e+=b+" {";for(d in a[b])Object.prototype.hasOwnProperty.call(a[b],d)&&(e+=d+":"+a[b][d]+";");e+="} "}return e},d=c(this._globalStyles),e=a("#m-select-d-box-style");return e.length||(e=a("<style />"),e.attr("id","m-select-d-box-style"),b.append(e)),e.html(d),this},_initProps:function(b){var c,d,e,f={},g=[{key:"name",type:"string"},{key:"list",type:"array"},{key:"autoApply",type:"any",into:"boolean"},{key:"autoPosition",type:"any",into:"boolean"},{key:"autoComplete",type:"any",into:"boolean"},{key:"target",type:"object"},{key:"multiple",type:"any",into:"boolean"},{key:"zIndex",type:"numeric",into:"integer"},{key:"width",type:"any"},{key:"embeddedInput",type:"any",into:"boolean"},{key:"optionFilters",type:"array"},{key:"closeButton",type:"boolean"},{key:"language",type:"string","default":this.detectLanguage()},{key:"freeWrite",type:"any",into:"boolean"}];for(c=0;c<g.length;c++)g[c].key=g[c].key.toLowerCase(),"default"in g[c]&&(f[g[c].key]=g[c]["default"]);if(this.set(f),"object"==typeof b){for(e in b)if(b.hasOwnProperty(e)){var h=e.toLowerCase(),i=null;for(d=0;d<g.length;d++)if(g[d].key.toLowerCase()==h){i=g[d];break}if(i){if("any"==i.type);else if("array"==i.type){if(!Array.isArray(b[e]))throw new Error("Argument data type mismatch (key: '"+e+"')")}else if("numeric"==i.type){if(isNaN(b[e]))throw new Error("Argument data type mismatch (key: '"+e+"')")}else if(i.type!=typeof b[e])throw new Error("Argument data type mismatch (key: '"+e+"')");i.hasOwnProperty("into")&&("boolean"==i.into?b[e]=Boolean(b[e]):"integer"==i.into?b[e]=parseInt(b[e]):"float"==i.into&&(b[e]=parseFloat(b[e]))),"width"==e&&(b[e]="undefined"==typeof b.width?"min":a.inArray(b.width,["min","auto"])>-1?b.width:parseInt(b.width)),this.set(h,b[e])}}this.set({firstItem:void 0,lastItem:void 0,hoveredCache:Object.create(null),hiddenCache:Object.create(null),selectedCache:Object.create(null),valuesCache:Object.create(null),labelsCache:Object.create(null)},null,!1)}},_initElements:function(){var b=a("body").get(0);this._globalElems.fade||(this._globalElems.fade=a('<div class="m-select-d-box-fade m-select-d-box_hidden"><div class="m-select-d-box-fade__outside-click-label"><div class="m-select-d-box-fade__outside-click-label-icon"></div><span class="m-select-d-box-fade__outside-click-label-text">'+this.getText(".m-select-d-box-fade__outside-click-label-text")+"<span></div></div>").get(0),b.appendChild(this._globalElems.fade));var c=document.createElement("div");this.set("dbox",c),c.className="m-select-d-box m-select-d-box_hidden";var d=a('<div class="m-select-d-box__search-input-container"><input class="m-select-d-box__search-input" placeholder="'+this.getText(".m-select-d-box__search-input")+'" type="text"></div>').get(0);this.set("dbox_input",a("input",d).get(0)),c.appendChild(d),Boolean(this.get("embeddedInput"))&&(d.className+=" m-select-d-box__search-input-container_active"),this.set("dbox",c),this.get("zIndex")&&(c.style.zIndex=this.get("zIndex")),c.appendChild(a('<ul class="m-select-d-box__list-container"></ul>').get(0));var e=this.get("width");"auto"==e?c.style.width=this.get("target").clientWidth+"px":"min"==e||(c.style.width=e+"px"),b.appendChild(c)},_initList:function(){var b=this.get("list",null,!1);if(!a.isArray(b))return this.set("list",[],null,!1),!1;var c,d,e,f=Object.create(null),g=Object.create(null),h=this,i=this.get("dbox",null,!1),j=a(".m-select-d-box__list-container",i).get(0);for(!this._onItemClick&&(this._onItemClick=function(a){clearTimeout(h._timers.focusoutInputs);var b=this.getAttribute("data-msdbid"),c=h.get("list",null,!1),d=h.getSelectedKeys().concat(b);h.get("multiple",null,!1)?c[b].selected?h._deselectByID(b):h._selectByID(b,!1):h._selectByID(b,!0),h.applySelectedToInput(),h.applySelectedToList(h._getItemsByID(d)),a.listItem=c[b],h.trigger("select",a),h.calcPosition(),h.get("multiple",null,!1)||h.close()}),!this._onMouseLeave&&(this._onMouseLeave=function(){var b=a(this);b.hasClass("m-select-d-box__list-item_hover")&&b.removeClass("m-select-d-box__list-item_hover")}),j.innerHTML="",c=0;c<b.length;c++)if([b[c]]+""){if(a.inArray(typeof b[c],["number","string"])>-1)b[c]={value:b[c]+"",label:b[c]+"",selected:!1};else{if("object"!=typeof b[c]||!this.fx.hop(b[c],"value")||!this.fx.hop(b[c],"label"))continue;"undefined"==typeof b[c].selected?b[c].selected=!1:b[c].selected=Boolean(b[c].selected),b[c].value+="",b[c].label+=""}b[c].id=c,g[b[c].value]=b[c],f[b[c].label]=b[c],e&&(e.next=b[c],b[c].prev=e),e=b[c],d=b[c],d.isHovered=!1,d.elem=document.createElement("li"),d.elem.className="m-select-d-box__list-item",d.elem.setAttribute("data-msdbid",c+""),d.$elem=a(d.elem),a(d.elem).bind("click",this._onItemClick,null),a(d.elem).bind("mouseleave",this._onMouseLeave,null),d.elem.innerHTML=d.label,j.appendChild(d.elem)}this.set("firstItem",b[0],null,!1),this.set("lastItem",b[b.length-1],null,!1),this.set("labelsCache",f,null,!1),this.set("valuesCache",g,null,!1)},init:function(b){this._props=Object.create(null);var c=this,d=a("body").get(0);this.events=Object.create(null),this._initProps(b),this._initTarget(),this._initElements(),this._initEvents(b),this._initList(),this._initStyles(),this.set("autoCompleteTimeoutDelay",500,null,!1),this.set("focusOutInputsTimeoutDelay",250,null,!1),this._timers=Object.create(null),this._timers.autoComplete=null,this._timers.focusedInputs=null,this._timers.focusoutInputs=null;var e=this.get("target",null,!1),f=this.get("dbox",null,!1);c.get("name",null,!1)&&(e.setAttribute("data-msdb-name",c.get("name",null,!1)),f.setAttribute("data-msdb-name",c.get("name",null,!1))),c.on("keydown",function(a,b){c._eventDefaultKeyDownMultipleFalse(b),c._eventDefaultKeyDownMultipleTrue(b)}),c.on("keyup",function(a,b){c._eventDefaultKeyUp(b)}),c.get("optionFilters",null,!1)||c.set("optionFilters",[c.defaultOptionFilters["default"]],null,!1),c._isColdInit()&&a(d).bind("click",function(a){c._deactivateInstances(a)},null),this.instances.push(this),c.trigger("init")},_applyLang:function(b){this._lastLang!=b&&(Object.getPrototypeOf(this)._lastLang=b,a(this._globalElems.fade).find(".m-select-d-box-fade__outside-click-label-text").html(this.getText(".m-select-d-box-fade__outside-click-label-text")))},calcPosition:function(){var b=this,c=a("body").get(0),d=this.get("target",null,!1),e=this.get("dbox",null,!1),f=a(e),g=a(d).offset(),h=d.clientWidth,i=d.clientHeight,j=e.clientWidth;f.removeClass("m-select-d-box_bottom"),e.style.left=g.left+h/2-(j+2*b._globalStyles[".m-select-d-box"].padding.replace(/[px]/gi,""))/2+"px";var k=window.scrollY||c.scrollTop;e.clientHeight+g.top+i+12-k>window.innerHeight?(e.style.top=g.top-12-e.clientHeight+"px",f.addClass("m-select-d-box_bottom")):e.style.top=g.top+i+12+"px"},calcScrollBarPosition:function(){var b=this.get("dbox",null,!1),c=a(".m-select-d-box__list-container",b).get(0),d=this.get("multiple",null,!1)?this.getHoveredItems()[0]:this.getSelectedItems()[0];if(d){var e=d.$elem.position().top+c.scrollTop;return e<c.clientHeight/2?c.scrollTop=0:void(c.scrollTop=e-c.clientHeight/2)}},_calcListContainerHeight:function(){var b=a(this.get("dbox",null,!1)).find(".m-select-d-box__list-container").get(0);if(this._isMobileState()){var c=window.innerHeight/100;return b.style.maxHeight=90*c-64-40+"px"}b.style.maxHeight&&(b.style.maxHeight="")},_isDBoxElement:function(b){var c=this.get("dbox",null,!1);return!!a(c).find(b).length||c==b},_isTargetElement:function(b){var c=this.get("target",null,!1);return!!a(c).find(b).length||c==b},_isDBoxInput:function(a){return this.get("dbox_input")===a},_isMobileState:function(){return window.innerWidth<=640||window.innerWidth<=740&&this.fx.isHDensScreen()},_isBoxBottomState:function(){var a=this.get("dbox",null,null);return Boolean(a.className.match(new RegExp("m-select-d-box_bottom")))},_isColdInit:function(){return!this.instances.length},getHoveredItems:function(){var a=this.get("hoveredCache",null,!1);return Object.keys(a).map(function(b){return a[b]})},getSelectedKeys:function(){return Object.keys(this.get("selectedCache",null,!1))},getSelectedValues:function(){var a=this.get("selectedCache",null,!1);return Object.keys(a).map(function(b){return a[b].value})},getSelectedLabels:function(){var a=this.get("selectedCache",null,!1);return Object.keys(a).map(function(b){return a[b].label})},getSelectedItems:function(){var a=this.get("selectedCache",null,!1);return Object.keys(a).map(function(b){return a[b]})},hasValue:function(a){var b=this.get("valuesCache",null,!1);return!!b[a]},hasLabel:function(a){var b=this.get("labelsCache",null,!1);return!!b[a]},applySelectedToList:function(b){return!b&&(b=this.get("list",null,!1)),Object.keys(b).forEach(function(c){b[c]&&a.fn[b[c].selected?"addClass":"removeClass"].call([b[c].elem],"m-select-d-box__list-item_selected")}),this},applySelectedToInput:function(){var b=this,c=b.getSelectedValues(),d=b.getSelectedLabels(),e=this.get("target",null,!1),f=this.get("dbox_input",null,!1);f.value=d.join("; ")+(d.length&&this.get("multiple")?";":"");var g=e.tagName.toLowerCase();if("input"==g)b.fx.isTextInput(e)&&(e.value=f.value);else if("textarea"==g)e.value=d.join(";\n")+(d.length&&this.get("multiple")?";\n":"");else if("select"==g)for(var h=0;h<e.options.length;h++)e.options[h].selected=a.inArray(e.options[h].value,c)>-1;return e.setAttribute("data-msdb-value",c.join(";")+(c.length&&this.get("multiple",null,!1)?";":"")),this},select:function(a){var b=this.getSelectedKeys();return this._select(a),this.applySelectedToList(this._getItemsByID(b.concat(this.getSelectedKeys()))),this.applySelectedToInput(),this},_select:function(b){if("object"==typeof b&&!a.isArray(b)){var c,d,e=!0;if("blank"in b&&(e=!!b.blank),"id"in b)return void this._selectByID(b.id,e);if("value"in b)c=b.value,d="value";else{if(!("label"in b))return;c=b.label,d="label"}return c=[].concat(c),!this.get("multiple",null,!1)&&c.length>1?null:void("value"==d?this._selectByValue(c,e):"label"==d&&this._selectByLabel(c,e))}},_selectByValue:function(a,b){b&&this._deselectAll();var c,d=this.get("valuesCache",null,!1),e=this.get("selectedCache",null,!1);for(c=0;c<a.length;c++)this.fx.hop(d,a[c])&&(d[a[c]].selected=!0,e[d[a[c]].id]=d[a[c]])},_selectByLabel:function(a,b){b&&this._deselectAll();var c,d=this.get("labelsCache",null,!1),e=this.get("selectedCache",null,!1);for(c=0;c<a.length;c++)this.fx.hop(d,a[c])&&(d[a[c]].selected=!0,e[d[a[c]].id]=d[a[c]])},deselect:function(a){var b=this.getSelectedKeys();return this._deselect(a),this.applySelectedToList(this._getItemsByID(b.concat(this.getSelectedKeys()))),this.applySelectedToInput(),this},_deselect:function(b){return a.isPlainObject(b)?"value"in b?this._deselectByValue([].concat(b.value)):"label"in b?this._deselectByLabel([].concat(b.label)):void("id"in b&&this._deselectByID(b.id)):void 0},_deselectByValue:function(a){a=[].concat(a);var b,c,d,e=this.get("valuesCache",null,!1),f=this.get("selectedCache",null,!1);for(b=0;b<a.length;b++)c=a[b],this.fx.hop(e,c)&&(d=e[c].id,e[c].selected=!1,delete f[d])},_deselectByLabel:function(a){a=[].concat(a);var b,c,d,e=this.get("labelsCache",null,!1),f=this.get("selectedCache",null,!1);for(b=0;b<a.length;b++)c=a[b],this.fx.hop(e,c)&&(d=e[c].id,e[c].selected=!1,delete f[d])},_getItemsByID:function(a){var b,c=Object.create(null),d=this.get("list",null,!1);for(b=0;b<a.length;b++)c[a[b]]=d[a[b]];return c},hideItem:function(a){if(a){var b=this.get("hiddenCache",null,!1);b[a.value]=a,a.$elem.addClass("m-select-d-box__list-item_hidden")}return this},unhideItem:function(a){if(a){var b=this.get("hiddenCache",null,!1);delete b[a.value],a.$elem.removeClass("m-select-d-box__list-item_hidden")}return this},unhideAllItems:function(){var a=this.get("hiddenCache",null,!1);Object.keys(a).forEach(function(b){this.unhideItem(a[b])},this)},isVisibleItem:function(a){return!!a&&!a.$elem.hasClass("m-select-d-box__list-item_hidden")},hoverItem:function(a){if(!a)return this;var b=this.get("hoveredCache",null,!1);return a.isHovered=!0,a.$elem.addClass("m-select-d-box__list-item_hover"),b[a.id]=a,this},unhoverItem:function(a){if(!a)return this;var b=this.get("hoveredCache",null,!1);return a.isHovered=!1,a.$elem.removeClass("m-select-d-box__list-item_hover"),delete b[a.id],this},unhoverAllItems:function(){var a=this.get("hoveredCache",null,!1);return Object.keys(a).forEach(function(b){this.unhoverItem(a[b])},this),this},hoverNextVisibleItem:function(a){var b=this.getNextVisibleItem(a);return b&&(this.unhoverItem(a),this.hoverItem(b)),this},hoverPrevVisibleItem:function(a){var b=this.getPrevVisibleItem(a);return b&&(this.unhoverItem(a),this.hoverItem(b)),this},getNextVisibleItem:function(a){return a&&a.next?this.isVisibleItem(a.next)?a.next:this.getNextVisibleItem(a.next):void 0},getPrevVisibleItem:function(a){return a&&a.prev?this.isVisibleItem(a.prev)?a.prev:this.getPrevVisibleItem(a.prev):void 0},selectNextVisibleItem:function(a){if(a){var b=this.getSelectedItems();return a=this.getNextVisibleItem(a),a||(a=arguments[0]),this._selectByID(a.id,!0),this.applySelectedToInput(),this.applySelectedToList(b.concat(this.getSelectedItems())),a}},selectPrevVisibleItem:function(a){if(a){var b=this.getSelectedItems();return a=this.getPrevVisibleItem(a),a||(a=arguments[0]),this._selectByID(a.id,!0),this.applySelectedToInput(),this.applySelectedToList(b.concat(this.getSelectedItems())),a}},getLastVisibleItem:function(){var a=this.get("lastItem",null,!1);return this.isVisibleItem(a)&&a||this.getPrevVisibleItem(a)},getFirstVisibleItem:function(){var a=this.get("firstItem",null,!1);return this.isVisibleItem(a)&&a||this.getNextVisibleItem(a)},_selectByID:function(a,b){a=[].concat(a);var c,d=this.get("list",null,!1),e=this.get("selectedCache",null,!1);for(b&&this._deselectAll(),c=0;c<a.length;c++)d.hasOwnProperty(a[c])&&(d[a[c]].selected=!0,e[a[c]]=d[a[c]])},_deselectByID:function(a){a=[].concat(a);var b,c=this.get("list",null,!1),d=this.get("selectedCache",null,!1);for(b=0;b<a.length;b++)c.hasOwnProperty(a[b])&&(c[a[b]].selected=!1,delete d[a[b]])},_optionFiltersMatcher:function(b,c,d){if(arguments.length<3)return!0;if("function"==typeof b&&(b=[b]),!a.isArray(b))return!1;for(var e=0;e<b.length;e++)if(b[e].call(this,c,d))return!0;return!1},defaultOptionFilters:{"default":function(a,b){if("string"!=typeof a||"string"!=typeof b)return!1;var c=new RegExp(a.toLowerCase().trim());return b=b.toString().toLowerCase(),Boolean(b.match(c))},russianKeyboard:function(a,b){if("string"!=typeof a||"string"!=typeof b)return!1;for(var c={"`":"ё","~":"ё",q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","{":"х","]":"ъ","}":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж",":":"э","'":"э",'"':"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б","<":"б",".":"ю",">":"ю"},d=a.toLowerCase().split(""),e=0,f=d.length;f>e;e++)c.hasOwnProperty(d[e])&&(d[e]=c[d[e]]);return this.defaultOptionFilters["default"](d.join(""),b)}},applyAutoComplete:function(a){var b=this.get("list",null,!1),c=Object.keys(b),d=this.get("hiddenCache",null,!1),e=this.get("optionFilters",null,!1);return a?c.forEach(function(c){this._optionFiltersMatcher(e,a,b[c].label)?this.unhideItem(b[c]):this.hideItem(b[c])},this):this.unhideAllOpt(),Object.keys(d).length==c.length?this.trigger("autocomplete:empty"):this.trigger("autocomplete:not-empty"),this},deselectAll:function(){return this._deselectAll(),this.applySelectedToList(),this.applySelectedToInput(),this},_deselectAll:function(){var a=this.get("selectedCache",null,!1);Object.keys(a).forEach(function(b){a[b].selected=!1,delete a[b]})},selectAll:function(){if(!this.get("multiple",null,!1))return this;var a,b,c=this.get("selectedCache",null,!1),d=this.get("list",null,!1),e=Object.keys(d);for(a=0;a<e.length;a++)b=e[a],d[b].selected=!0,c[b]=d[b];return this.applySelectedToList(),this.applySelectedToInput(),this},isActive:function(){var b=this.get("dbox",null,null);return 0==a(b).hasClass("m-select-d-box_hidden")},reInitList:function(){this._initList();var a,b,c=(this.get("list"),this.get("selectedCache",null,!1)),d=this.get("valuesCache",null,!1),e=this.get("labelsCache",null,!1),f=this.get("hoveredCache",null,!1),g=Object.keys(c);for(a=0;a<g.length;a++)b=g[a],d[c[b].value]&&e[c[b].label]?(c[b]=d[c[b].value],c[b].selected=!0):delete c[b];Object.keys(f).forEach(function(a){f.isHovered=!1,delete f[a]}),this.applySelectedToInput(),this.applySelectedToList()},close:function(){var b=this.get("dbox",null,!1);return a(b).addClass("m-select-d-box_hidden"),this._closeFade(),this.unhoverAllItems(),this},open:function(){var b=this.get("dbox",null,!1);return a(b).removeClass("m-select-d-box_hidden"),this.calcPosition(),this._openFade(),this._applyLang(this.get("language",null,!1)),this._isMobileState()&&this.get("dbox_input").focus(),this},_openFade:function(){a(this._globalElems.fade).removeClass("m-select-d-box_hidden")},_closeFade:function(){a(this._globalElems.fade).addClass("m-select-d-box_hidden")},destroy:function(){var b=this,c=this.get("target",null,0),d=Object.getPrototypeOf(this);c.removeAttribute("data-msdb-name"),c.removeAttribute("data-msdb-value"),this.set("target",void 0,null,!1),a(this.get("dbox")).remove(),d.instances=a.grep(d.instances,function(a){return a!=b})},fx:{isTextInput:function(b){if(b instanceof Node==!1)return!1;var c=b.tagName.toLowerCase();if("input"==c){if(b.type&&a.inArray(b.type.toLowerCase(),["text","password","email","url","search","tel"])>-1)return!0}else if("textarea"==c)return!0;return!1},isHDensScreen:function(){return window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches)||window.devicePixelRatio&&window.devicePixelRatio>1.3||!1},isRetinaScreen:function(){return window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx), only screen and (min-resolution: 75.6dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min--moz-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2)").matches)||window.devicePixelRatio&&window.devicePixelRatio>=2||!1},msplit:function(a,b){return b=b.replace(new RegExp("["+a.join("")+"]","g"),a[0]),b.split(a[0])},trim:function(a,b,c){var d=[];return c&&"left"!=c||d.push("^["+b+"]+"),c&&"right"!=c||d.push("["+b+"]+$"),a.replace(new RegExp(d.join("|"),"g"),"")},rest:function(a,b){return"object"!=typeof a?[]:"number"!=typeof b?[]:Array.prototype.slice.call(a,b)},hop:function(a,b){return"hasOwnProperty"in a?Object.prototype.hasOwnProperty.call(a,b):b in a}}},b.prototype.unhoverAllOpt=b.prototype.unhoverAllItems,b.prototype.unhideAllOpt=b.prototype.unhideAllItems;var c={open:1,close:1,isActive:1,get:1,set:1,select:1,selectAll:1,deselectAll:1,on:1,trigger:1,getSelectedLabels:1,getSelectedValues:1,getSelectedKeys:1,getText:1,setText:1},d={open:1,close:1,set:1,select:1,selectAll:1,deselectAll:1,on:1,trigger:1,setText:1},e=a.fn.val;a.fn.extend({
val:function(a){return this.attr("data-msdb-value")?a?this.mSelectDBox().select({value:a})&&this:this.mSelectDBox().getSelectedValues():e.apply(this,arguments)},mSelectDBox:function(a){if(this.length){var e,f,g,h=b.prototype.getInstances(),i=void 0,j=this[0];for(e=0;e<h.length;e++)if(h[e].get("target")==j){i=h[e];break}if(!arguments.length)return i;if("string"==typeof a){if(c[a]&&(g=b.prototype.fx.rest(arguments,1),"function"==typeof i[a]))return f=i[a].apply(i,g),d[a]?this:f}else if("object"==typeof a)return a.target=this[0],new b(a);return this}}}),a.prototype.mSelectDBox.prototype=b.prototype}(jQuery);
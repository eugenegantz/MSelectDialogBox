!function(a){"use strict";var b=function(a){this.init(a)};b.prototype={instances:[],_coldInit:0,get:function(a,b,c){return"string"==typeof a?(a=a.toLowerCase(),(c||void 0===c)&&(this.trigger("get"),this.trigger("get:"+a)),this._props[a]):void 0},set:function(a,b,c,d){if(!a)return!1;if("object"==typeof a){var e=Object.create(null);for(var f in a)Object.prototype.hasOwnProperty.call(a,f)&&(e[f]=this.set(f,a[f],null,d));return e}if("string"!=typeof a)return!1;a=a.toLowerCase();var g={value:b};return"undefined"==typeof d&&(d=!0),d&&(this.trigger("set",g),this.trigger("set:"+a,g),this.trigger("beforeSet:"+a,g)),this._props[a]=b,d&&this.trigger("afterSet:"+a,g),!0},getInstances:function(b){if(!arguments.length)return this.instances;"object"!=typeof b&&(b=Object.create(null));for(var c=a.inArray(typeof b.name,["string","number"])>-1?b.name:null,d=[],e=0;e<this.instances.length;e++)(null===c||this.instances[e].get("name",void 0,!1)==c)&&d.push(this.instances[e]);return d},removeInstances:function(b){if("object"==typeof b){for(var c="string"!=typeof b.name?null:b.name,d=[],e=0;e<this.instances.length;e++)this.instances[e].get("name",void 0,!1)!=c?d.push(this.instances[e]):a(this.instances[e].get("dbox",void 0,!1)).detach();this.instances=d}},_targetEvents:{click:{name:"click",event:"click"},keydown:{name:"keydown",event:"keydown",dbox_input:!0},keyup:{name:"keyup",event:"keyup",dbox_input:!0},hover:{name:"hover",event:"hover"},focus:{name:"focus",event:"focus"},focusout:{name:"focusout",event:"focusout"},change:{name:"change",event:"change"}},_eventCheckInputEmpty:function(a){this.fx.isTextInput(a.target)&&!a.target.value.trim()&&this.trigger("input:empty",a)},_eventDefaultInputEmpty:function(){this.deselectAll()},_eventSetList:function(){var a=arguments[1];this.set("list",a.value,null,!1),this.reInitList()},_eventWindowResize:function(){for(var a=0;a<this.instances.length;a++)this.instances[a].isActive()&&(this.instances[a]._calcListContainerHeight(),this.instances[a].calcPosition())},_eventDefaultKeyUp:function(b){var c=this,d=c.get("target",null,0),e=c.get("dbox_input",null,0),f=b.keyCode,g=c.get("list",null,0),h=(c.get("dbox",null,0),b.currentTarget),i=[37,38,39,40,9,13,18,17,16,20,27];c._isDBoxInput(b.target)?c.fx.isTextInput(d)&&(d.value=e.value):h==d&&-1==a.inArray(b.keyCode,i)&&(e.value=d.value),clearTimeout(c._timers.autoComplete),c._timers.autoComplete=setTimeout(function(){var b,d,e,j;if(c.get("autoComplete",null,0)&&a.inArray(f,i)<0){for(b=h.value.toLowerCase().split(/[;,]/gi),b=b[b.length-1],d=0;d<g.length;d++)e=[g[d].elem],b?c._optionFiltersMatcher(c.get("optionFilters",null,0),b,g[d].label)?a.fn.removeClass.call(e,"m-select-d-box__list-item_hidden"):a.fn.addClass.call(e,"m-select-d-box__list-item_hidden"):a.fn.removeClass.call(e,"m-select-d-box__list-item_hidden"),a.fn.removeClass.call(e,"m-select-d-box__list-item_hover");c._isMobileState()||c.calcPosition()}if(c.get("multiple",null,0)&&8==f){for(b=c.fx.trim(h.value," ;,").split(/[,;]/gi),j=c.getSelectedKeys(),d=0;d<b.length;d++)b[d]=b[d].trim();c._selectByLabel(b,1),c.applySelectedToList(c._getItemsByID(j.concat(c.getSelectedKeys()))),c.applySelectedToInput()}},500)},_eventDefaultKeyDownMultipleFalse:function(b){var c=this,d=this.get("list",null,0),e=this.get("selectedCache",null,0),f=e[Object.keys(e)[0]],g=f,h=(c.get("dbox",null,0),c.get("target",null,0));if(!c.get("multiple",null,0))if(a.inArray(b.keyCode,[37,39,9,18,17,16,20,27])>-1);else if(13==b.keyCode)c.isActive()?c.close():(c.open(),c._eventFocus.call(h,c,b));else if(a.inArray(b.keyCode,[38,39,40])>-1){if(!c.isActive())return;if(f)if(38==b.keyCode)f=this._getPrevAvailItem(f)||f;else{if(40!=b.keyCode)return;f=this._getNextAvailItem(f)||f}else f=d[0];c._selectByID(f.id,1),c.applySelectedToInput(),c.applySelectedToList([g,f]),c._calcScrollBarPosition(),c.trigger("select",b)}},_eventDefaultKeyDownMultipleTrue:function(b){var c,d,e,f,g,h=this,i=h.get("list",null,0),j=h.get("dbox",null,0);if(h.get("multiple")){if(a.inArray(b.keyCode,[37,39,9,18,17,16,20,27])>-1);else if(13==b.keyCode){if(f=a(".m-select-d-box__list-item_hover",j),!f.length)return;return e=+f.attr("data-msdbid"),g=h.getSelectedKeys(),i[e].selected?h._deselectByID(e):h._selectByID(e),g=g.concat(g,h.getSelectedKeys()),h.applySelectedToInput(),h.applySelectedToList(h._getItemsByID(g)),void h.trigger("select",b)}if(a.inArray(b.keyCode,[38,40])>-1){var k=a(".m-select-d-box__list-item:not(.m-select-d-box__list-item_hidden)",j);f=-1;var l;for(c=0,d=k.length;d>c;c++)l=a(k[c]),l.hasClass("m-select-d-box__list-item_hover")&&(f=c);var m;if(38==b.keyCode)m=0>f-1?0:f-1;else{if(40!=b.keyCode)return;m=f+1>k.length-1?k.length-1:f+1}a(k[m]).addClass("m-select-d-box__list-item_hover"),f>-1&&m!=f&&a(k[f]).removeClass("m-select-d-box__list-item_hover"),h._calcScrollBarPosition()}}},_eventFocus:function(b,c){var d,e,f,g,h=this,i=h.getSelectedKeys(),j=(h.get("list",null,0),h.get("dbox",null,0)),k=c.currentTarget||(this instanceof Element?this:null);if(h.open(),h.fx.isTextInput(k))if(g=k.getAttribute("data-msdb-value"),g&&(g=g.trim()),g){for(g=g.split(/[;,]/gi),d=0;d<g.length;d++)g[d]=g[d].trim();h._selectByValue(g,1)}else{for(f=h.fx.trim(k.value,",; ").split(/[;,]/gi),d=0;d<f.length;d++)f[d]=f[d].trim();h._selectByLabel(f,1)}var l=a("li",j);if(l.length)for(l.removeClass("m-select-d-box__list-item_hidden"),e=0;e<l.length;e++)"undefined"!=typeof k.type&&a.inArray(k.type.toLowerCase(),["submit","button"])>-1||a.inArray(k.tagName.toLowerCase(),["submit","body","select"])>-1||a(l[e]).removeClass("m-select-d-box__list-item_hover");i=i.concat(h.getSelectedKeys()),h.get("freeWrite")||h.applySelectedToInput(),h.applySelectedToList(h._getItemsByID(i)),h._calcScrollBarPosition(),h._calcListContainerHeight()},_initEvents:function(b){var c,d=(a("body").get(0),this);this.events=Object.create(null);var e={};for(c in b)b.hasOwnProperty(c)&&"function"==typeof b[c]&&(e[c.replace(/^on/,"")]=b[c]);for(c in b.events)b.events.hasOwnProperty(c)&&"function"==typeof b.events[c]&&(e[c]=b.events[c]);for(c in e)e.hasOwnProperty(c)&&this.on(c,e[c]);this.on("keyup",function(a,b){d._eventCheckInputEmpty(b)}),this.on("change",function(a,b){d._eventCheckInputEmpty(b)}),this.on("input:empty",d._eventDefaultInputEmpty),this.on("focus",d._eventFocus),this.on("click",d._eventFocus),this.on("focusout",function(a,b){return b.relatedTarget?void(d._isDBoxInput(b.relatedTarget)||d._isDBoxElement(b.relatedTarget)||d._isTargetElement(b.relatedTarget)||d.close()):void(d._timers.focusoutInputs=setTimeout(function(){d.close()},250))}),a(this.get("dbox_input")).bind("focus",function(){clearTimeout(d._timers.focusoutInputs)}),this.on("afterSet:list",this._eventSetList),d._isColdInit()&&window.addEventListener("resize",d._eventWindowResize.bind(d),!1)},_deactivateInstances:function(a){for(var b=0;b<this.instances.length;b++)this.instances[b]._isDBoxElement(a.target)||this.instances[b]._isTargetElement(a.target)||this.instances[b].isActive()&&this.instances[b].close()},_initTarget:function(){var b,c=this.get("target");if(c&&"object"==typeof c)if("string"==typeof c)c=a(c),this.set("target",c.length?c.get(0):null);else if(c instanceof Element)this.set("target",c);else if("object"==typeof c&&"undefined"!=typeof c.push||Array.isArray(c))for(b=0;b<c.length;b++)if(c[b]instanceof Element){this.set("target",c[b]);break}},trigger:function(b,c){if("string"==typeof b&&(b=b.toLowerCase(),"object"==typeof this.events[b]&&Array.isArray(this.events[b]))){!c||c instanceof(window.CustomEvent||Function)==0&&c instanceof(window.Event||Function)==0&&c instanceof a.Event==0?c=a.Event(b,c):c instanceof a.Event==0&&(c=a.Event(b,c));for(var d=this.events[b],e=0;e<d.length;e++)"function"==typeof d[e]&&d[e].call(this,this,c)}},on:function(b,c){var d=this,e=this.get("target"),f=this.get("dbox_input");return"string"!=typeof b||"function"!=typeof c?!1:(b=b.toLowerCase(),"object"==typeof this.events[b]&&Array.isArray(this.events[b])||(this.events[b]=[],this._targetEvents.hasOwnProperty(b)&&(a(e).bind(this._targetEvents[b].event,function(a){d.trigger(b,a)},null),this._targetEvents[b].dbox_input&&a(f).bind(this._targetEvents[b].event,function(a){d.trigger(b,a)},null))),this.events[b].push(c),!0)},_detectLanguage:function(){var a=(navigator.languages||[])[0]||navigator.language||navigator.systemLanguage||navigator.userLanguage||navigator.browserLanguage||"en-US";return a.split(/[-_]/gi)[0]},_lastLang:"",_texts:{".m-select-d-box-fade__outside-click-label-text":{ru:"Нажмите чтобы закрыть",en:"Tap to close"},".m-select-d-box__search-input":{ru:"Поиск",en:"Search"}},getText:function(a,b){return!b&&(b=this.get("language")||this._detectLanguage()),(this._texts[a]||{})[b]||""},setText:function(a,c,d){var e=!0,f=this instanceof b?!(e=!1)&&Object.getPrototypeOf(this):this;!f._texts[c]&&(f._texts[c]={}),!d&&(d=!e&&this.get("language")||this._detectLanguage()),f._texts[c][d]=a},_globalElems:{fade:void 0},_globalStyles:function(){var a={".m-select-d-box":{position:"absolute",display:"block",width:"168px",padding:"8px",height:"auto","box-shadow":"0 0px 8px rgba(0, 0, 0, 0.24)","background-color":"#FFF","border-radius":"3px"},".m-select-d-box:after":{content:"''",position:"absolute","border-left":"10px solid transparent","border-right":"9px solid transparent","border-bottom":"10px solid white",top:"-10px",left:"50%","margin-left":"-10px"},".m-select-d-box_bottom:after":{content:"''",position:"absolute","border-left":"10px solid transparent","border-right":"9px solid transparent","border-bottom":"none","border-top":"10px solid white",top:"auto",bottom:"-10px",left:"50%","margin-left":"-10px"},".m-select-d-box__list-container":{position:"relative",margin:"0px",padding:"0px","max-height":"200px","overflow-x":"hidden"},".m-select-d-box__list-item":{position:"relative",padding:"5px","background-color":"none",color:"black",display:"block","line-height":"100%",cursor:"pointer","font-size":"12px"},".m-select-d-box__list-item:hover, .m-select-d-box__list-item_hover":{"background-color":"#e6e6e6"},".m-select-d-box__list-item_selected":{"background-color":"#C40056",color:"white"},".m-select-d-box__list-item_selected:hover, .m-select-d-box__list-item_selected.m-select-d-box__list-item_hover":{"background-color":"#DB2277"},".m-select-d-box__list-item_selected:before":{content:"':: '"},".m-select-d-box__list-item:active, .m-select-d-box__list-item_selected:active":{"background-color":"#b80000",color:"white"},".m-select-d-box__list-item_hidden":{display:"none"},".m-select-d-box__search-input":{border:"1px solid #a2a2a2",width:"100%","line-height":"100%","font-size":"14px","border-width":"0 0 2px 0",padding:"8px","box-sizing":"border-box"},".m-select-d-box__search-input-container":{"margin-bottom":"12px",display:"none"},".m-select-d-box__search-input-container_active":{display:"block"},".m-select-d-box-fade":{display:"none",width:0,height:0,left:0,top:0},".m-select-d-box-fade__outside-click-label":{position:"absolute",width:"100%",bottom:0,padding:"10px",background:"black",color:"white","text-align":"center","font-size":"1em","box-sizing":"border-box"},".m-select-d-box-fade__outside-click-label-text":{},".m-select-d-box-fade__outside-click-label-icon":{position:"relative","border-radius":"50%","margin-right":"5px",border:"2px solid white",display:"inline-block",height:"16px",width:"16px","vertical-align":"middle"},".m-select-d-box-fade__outside-click-label-icon:after":{content:"''",position:"absolute",top:"50%",left:"50%",height:"80%",width:"2px",transform:"rotate(45deg)","margin-left":"-1px","margin-top":"-40%",background:"white"},".m-select-d-box-fade__outside-click-label-icon:before":{content:"''",position:"absolute",top:"50%",left:"50%",height:"80%",width:"2px",transform:"rotate(-45deg)","margin-left":"-1px","margin-top":"-40%",background:"white"},"@media screen and (max-width: 640px)":{".m-select-d-box":{position:"fixed",width:"80% !important",padding:"0 !important",left:"10% !important",top:"5% !important","max-height":"90%","box-shadow":"none","border-radius":"0px","box-sizing":"border-box"},".m-select-d-box:after":{content:"none"},".m-select-d-box__list-container":{"max-height":"none"},".m-select-d-box__list-item":{padding:"1em","font-size":"1em"},".m-select-d-box__search-input-container":{"margin-bottom":"12px",display:"block"},".m-select-d-box__search-input":{"line-height":"1em","font-size":"1em",padding:"1em"},".m-select-d-box-fade":{width:"100%",height:"100%",position:"fixed",left:0,top:0,"background-color":"rgba(0, 0, 0, 0.33)",display:"block"}},"@media screen and (max-width: 740px)":{"@media screen and (min-resolution: 2dppx)":{}},".m-select-d-box_hidden":{display:"none"}};return a["@media screen and (max-width: 740px)"]["@media screen and (min-resolution: 2dppx)"]=a["@media screen and (max-width: 640px)"],a}(),_initStyles:function(){a("#m-select-d-box-style").length||this._buildStyles()},_buildStyles:function(){var b=a("body"),c=function(a){var b="";for(var d in a)if(Object.prototype.hasOwnProperty.call(a,d))if(d.match(/^@media/))b+=d+" {"+c(a[d])+"} ";else{b+=d+" {";for(var e in a[d])Object.prototype.hasOwnProperty.call(a[d],e)&&(b+=e+":"+a[d][e]+";");b+="} "}return b},d=c(this._globalStyles),e=a("#m-select-d-box-style");e.length||(e=a("<style />"),e.attr("id","m-select-d-box-style"),b.append(e)),e.html(d)},_initProps:function(b){var c,d,e,f={},g=[{key:"name",type:"string"},{key:"list",type:"array"},{key:"autoApply",type:"any",into:"boolean"},{key:"autoPosition",type:"any",into:"boolean"},{key:"autoComplete",type:"any",into:"boolean"},{key:"target",type:"object"},{key:"multiple",type:"any",into:"boolean"},{key:"zIndex",type:"numeric",into:"integer"},{key:"width",type:"any"},{key:"embeddedInput",type:"any",into:"boolean"},{key:"optionFilters",type:"array"},{key:"closeButton",type:"boolean"},{key:"language",type:"string","default":this._detectLanguage()},{key:"freeWrite",type:"any",into:"boolean"}];for(c=0;c<g.length;c++)g[c].key=g[c].key.toLowerCase(),"default"in g[c]&&(f[g[c].key]=g[c]["default"]);if(this.set(f),"object"==typeof b){for(e in b)if(b.hasOwnProperty(e)){var h=e.toLowerCase(),i=null;for(d=0;d<g.length;d++)if(g[d].key.toLowerCase()==h){i=g[d];break}if(i){if("any"==i.type);else if("array"==i.type){if(!Array.isArray(b[e]))throw new Error("Argument data type mismatch (key: '"+e+"')")}else if("numeric"==i.type){if(isNaN(b[e]))throw new Error("Argument data type mismatch (key: '"+e+"')")}else if(i.type!=typeof b[e])throw new Error("Argument data type mismatch (key: '"+e+"')");i.hasOwnProperty("into")&&("boolean"==i.into?b[e]=Boolean(b[e]):"integer"==i.into?b[e]=parseInt(b[e]):"float"==i.into&&(b[e]=parseFloat(b[e]))),"width"==e&&(b[e]="undefined"==typeof b.width?"min":a.inArray(b.width,["min","auto"])>-1?b.width:parseInt(b.width)),this.set(h,b[e])}}this.set({firstItem:void 0,lastItem:void 0,selectedCache:Object.create(null),valuesCache:Object.create(null),labelsCache:Object.create(null)},null,0)}},_initElements:function(){var b=a("body").get(0);this.get("language");this._isColdInit()&&(this._globalElems.fade=a('<div class="m-select-d-box-fade m-select-d-box_hidden"><div class="m-select-d-box-fade__outside-click-label"><div class="m-select-d-box-fade__outside-click-label-icon"></div><span class="m-select-d-box-fade__outside-click-label-text">'+this.getText(".m-select-d-box-fade__outside-click-label-text")+"<span></div></div>").get(0),b.appendChild(this._globalElems.fade));var c=document.createElement("div");this.set("dbox",c),c.className="m-select-d-box m-select-d-box_hidden";var d=a('<div class="m-select-d-box__search-input-container"><input class="m-select-d-box__search-input" placeholder="'+this.getText(".m-select-d-box__search-input")+'" type="text"></div>').get(0);this.set("dbox_input",a("input",d).get(0)),c.appendChild(d),Boolean(this.get("embeddedInput"))&&(d.className+=" m-select-d-box__search-input-container_active"),this.set("dbox",c),this.get("zIndex")&&(c.style.zIndex=this.get("zIndex")),c.appendChild(a('<ul class="m-select-d-box__list-container"></ul>').get(0));var e=this.get("width");"auto"==e?c.style.width=this.get("target").clientWidth+"px":"min"==e||(c.style.width=e+"px"),b.appendChild(c)},_initList:function(){var b=this.get("list",null,0);if(!a.isArray(b))return this.set("list",[],null,!1),!1;var c,d,e,f=Object.create(null),g=Object.create(null),h=this,i=this.get("dbox",null,0),j=a(".m-select-d-box__list-container",i).get(0);for(!this._onItemClick&&(this._onItemClick=function(a){clearTimeout(h._timers.focusoutInputs);var b=this.getAttribute("data-msdbid"),c=h.get("list",null,0),d=h.getSelectedKeys().concat(b);h.get("multiple",null,0)?c[b].selected?h._deselectByID(b):h._selectByID(b,0):h._selectByID(b,1),h.applySelectedToInput(),h.applySelectedToList(h._getItemsByID(d)),h.trigger("select",a),h.calcPosition(),h.get("multiple",null,0)||h.close()}),!this._onMouseLeave&&(this._onMouseLeave=function(){var b=a(this);b.hasClass("m-select-d-box__list-item_hover")&&b.removeClass("m-select-d-box__list-item_hover")}),j.innerHTML="",c=0;c<b.length;c++)a.inArray(typeof b[c],["number","string"])>-1?b[c]={value:b[c]+"",label:b[c]+"",selected:!1}:"object"==typeof b[c]&&this.fx.hop(b[c],"value")&&this.fx.hop(b[c],"label")&&("undefined"==typeof b[c].selected?b[c].selected=!1:b[c].selected=Boolean(b[c].selected)),b[c].id=c,g[b[c].value]=b[c],f[b[c].label]=b[c],e&&(e.next=b[c],b[c].prev=e),e=b[c],d=b[c],d.elem=document.createElement("li"),d.elem.className="m-select-d-box__list-item",d.elem.setAttribute("data-msdbid",c),a(d.elem).bind("click",this._onItemClick,null),a(d.elem).bind("mouseleave",this._onMouseLeave,null),d.elem.innerHTML=d.label,j.appendChild(d.elem);this.set("firstItem",b[0],null,0),this.set("lastItem",b[b.length-1],null,0),this.set("labelsCache",f,null,0),this.set("valuesCache",g,null,0)},init:function(b){this._props=Object.create(null);var c=this,d=a("body").get(0);this.events=Object.create(null),this._initProps(b),this._initTarget(),this._initElements(),this._initEvents(b),this._initList(),this._initStyles(),this._timers=Object.create(null),this._timers.autoComplete=null,this._timers.focusedInputs=null,this._timers.focusoutInputs=null;var e=this.get("target",null,0),f=this.get("dbox",null,0);c.get("name",null,0)&&(e.setAttribute("data-msdb-name",c.get("name",null,0)),f.setAttribute("data-msdb-name",c.get("name",null,0))),c.on("keydown",function(a,b){c._eventDefaultKeyDownMultipleFalse(b),c._eventDefaultKeyDownMultipleTrue(b)}),c.on("keyup",function(a,b){c._eventDefaultKeyUp(b)}),c.get("optionFilters",null,0)||c.set("optionFilters",[c.defaultOptionFilters["default"]],null,!1),c._isColdInit()&&a(d).bind("click",function(a){c._deactivateInstances(a)},null),this.instances.push(this)},_applyLang:function(b){this._lastLang!=b&&(Object.getPrototypeOf(this)._lastLang=b,a(this._globalElems.fade).find(".m-select-d-box-fade__outside-click-label-text").html(this.getText(".m-select-d-box-fade__outside-click-label-text")))},calcPosition:function(){var b=this,c=a("body").get(0),d=this.get("target",null,0),e=this.get("dbox",null,0),f=a(e),g=a(d).offset(),h=d.clientWidth,i=d.clientHeight,j=e.clientWidth;f.removeClass("m-select-d-box_bottom"),e.style.left=g.left+h/2-(j+2*b._globalStyles[".m-select-d-box"].padding.replace(/[px]/gi,""))/2+"px";var k=window.scrollY||c.scrollTop;e.clientHeight+g.top+i+12-k>window.innerHeight?(e.style.top=g.top-12-e.clientHeight+"px",f.addClass("m-select-d-box_bottom")):e.style.top=g.top+i+12+"px"},_calcScrollBarPosition:function(){var b,c=this.get("dbox",null,0),d=a(".m-select-d-box__list-container",c).get(0);if(b=this.get("multiple",null,0)?a(".m-select-d-box__list-item_hover",c):a(".m-select-d-box__list-item_selected",c),b.length){var e=b.position().top+d.scrollTop;return e<d.clientHeight/2?void(d.scrollTop=0):void(d.scrollTop=e-d.clientHeight/2)}},_calcListContainerHeight:function(){var b=a(this.get("dbox",null,0)).find(".m-select-d-box__list-container").get(0);if(this._isMobileState()){var c=window.innerHeight/100;return void(b.style.maxHeight=90*c-64-40+"px")}b.style.maxHeight&&(b.style.maxHeight="")},_isDBoxElement:function(b){var c=this.get("dbox",null,0);return!!a(c).find(b).length||c==b},_isTargetElement:function(b){var c=this.get("target",null,0);return!!a(c).find(b).length||c==b},_isDBoxInput:function(a){return this.get("dbox_input")===a},_isMobileState:function(){return window.innerWidth<=640||window.innerWidth<=740&&this.fx.isHDensScreen()},_isBoxBottomState:function(){var a=this.get("dbox",null,null);return Boolean(a.className.match(new RegExp("m-select-d-box_bottom")))},_isColdInit:function(){return!this.instances.length},getSelectedKeys:function(){return Object.keys(this.get("selectedCache",null,0))},getSelectedValues:function(){var a=[],b=this.get("selectedCache",null,0);for(var c in b)a.push(b[c].value);return a},getSelectedLabels:function(){var a=[],b=this.get("selectedCache",null,0);for(var c in b)a.push(b[c].label);return a},hasValue:function(a){var b=this.get("valuesCache",null,0);return!!b[a]},hasLabel:function(a){var b=this.get("labelsCache",null,0);return!!b[a]},applySelectedToList:function(b){!b&&(b=this.get("list",null,0));for(var c in b)this.fx.hop(b,c)&&b[c]&&a.fn[b[c].selected?"addClass":"removeClass"].call([b[c].elem],"m-select-d-box__list-item_selected")},applySelectedToInput:function(){var b=this,c=b.getSelectedValues(),d=b.getSelectedLabels(),e=this.get("target",null,0),f=this.get("dbox_input",null,0);f.value=d.join("; ")+(d.length&&this.get("multiple")?";":"");var g=e.tagName.toLowerCase();if("input"==g)b.fx.isTextInput(e)&&(e.value=f.value);else if("textarea"==g)e.value=d.join(";\n")+(d.length&&this.get("multiple")?";\n":"");else if("select"==g)for(var h=0;h<e.options.length;h++)e.options[h].selected=a.inArray(e.options[h].value,c)>-1;e.setAttribute("data-msdb-value",c.join(";")+(c.length&&this.get("multiple",null,0)?";":""))},select:function(a){var b=this.getSelectedKeys();this._select(a),this.applySelectedToList(this._getItemsByID(b.concat(this.getSelectedKeys()))),this.applySelectedToInput()},_select:function(b){if("object"==typeof b&&!a.isArray(b)){var c,d,e=!0;if(b.blank&&(e=!!b.blank),!isNaN(b.id)||a.isArray(b.id))return void this._selectByID(b.id,1);if(b.value)c=b.value,d="value";else{if(!b.label)return;c=b.label,d="label"}if(a.inArray(typeof c,["number","string"])>-1)c=[c];else if("object"!=typeof c||!a.isArray(c))return null;return!this.get("multiple",null,0)&&c.length>1?null:void("value"==d?this._selectByValue(c,e):"label"==d&&this._selectByLabel(c,e))}},_selectByValue:function(a,b){b&&this._deselectAll();var c,d=this.get("valuesCache",null,0),e=this.get("selectedCache",null,0);for(c=0;c<a.length;c++)this.fx.hop(d,a[c])&&(d[a[c]].selected=!0,e[d[a[c]].id]=d[a[c]])},_selectByLabel:function(a,b){b&&this._deselectAll();var c,d=this.get("labelsCache"),e=this.get("selectedCache",null,0);for(c=0;c<a.length;c++)this.fx.hop(d,a[c])&&(d[a[c]].selected=!0,e[d[a[c]].id]=d[a[c]])},_getItemsByID:function(a){var b,c=Object.create(null),d=this.get("list",null,0);for(b=0;b<a.length;b++)c[a[b]]=d[a[b]];return c},_getNextAvailItem:function(a){return a.next?a.next.elem.className.match(/m-select-d-box__list-item_hidden/i)?this._getNextAvailItem(a.next):a.next:void 0},_getPrevAvailItem:function(a){return a.prev?a.prev.elem.className.match(/m-select-d-box__list-item_hidden/i)?this._getPrevAvailItem(a.prev):a.prev:void 0},_selectByID:function(b,c){if(isNaN(b)){if(!a.isArray(b)||!b.length)return}else b=[b];var d,e=this.get("list",null,0),f=this.get("selectedCache",null,0);for(c&&this._deselectAll(),d=0;d<b.length;d++)isNaN(b[d])||e.hasOwnProperty(b[d])&&(e[b[d]].selected=!0,f[b[d]]=e[b[d]])},_deselectByID:function(b){if(isNaN(b)){if(!a.isArray(b)||!b.length)return}else b=[parseInt(b)];var c,d=this.get("list",null,0),e=this.get("selectedCache",null,0);for(c=0;c<b.length;c++)isNaN(b[c])||d.hasOwnProperty(b[c])&&(d[b[c]].selected=!1,delete e[b[c]])},_optionFiltersMatcher:function(b,c,d){if(arguments.length<3)return!0;if("function"==typeof b&&(b=[b]),!a.isArray(b))return!1;for(var e=0;e<b.length;e++)if(b[e].call(this,c,d))return!0;return!1},defaultOptionFilters:{"default":function(a,b){if("string"!=typeof a||"string"!=typeof b)return!1;var c=new RegExp(a.toLowerCase().trim());return b=b.toString().toLowerCase(),Boolean(b.match(c))},russianKeyboard:function(a,b){if("string"!=typeof a||"string"!=typeof b)return!1;for(var c={"`":"ё","~":"ё",q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","{":"х","]":"ъ","}":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж",":":"э","'":"э",'"':"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б","<":"б",".":"ю",">":"ю"},d=a.toLowerCase().split(""),e=0,f=d.length;f>e;e++)c.hasOwnProperty(d[e])&&(d[e]=c[d[e]]);return this.defaultOptionFilters["default"](d.join(""),b)}},deselectAll:function(){this._deselectAll(),this.applySelectedToList(),this.applySelectedToInput()},_deselectAll:function(){var a=this.get("selectedCache",null,0);for(var b in a)a[b].selected=!1,delete a[b]},selectAll:function(){if(this.get("multiple",null,0)){var a,b=this.get("list",null,0);for(a=0;a<b.length;a++)b[a].selected=!0;this.applySelectedToList(),this.applySelectedToInput()}},isActive:function(){var b=this.get("dbox",null,null);return 0==a(b).hasClass("m-select-d-box_hidden")},reInitList:function(){var b=this.get("dbox",null,0);a("ul",b).detach(),this._initList()},close:function(){var b=this.get("dbox",null,0);a(b).addClass("m-select-d-box_hidden"),this._closeFade()},open:function(){var b=this.get("dbox",null,0);a(b).removeClass("m-select-d-box_hidden"),this.calcPosition(),this._openFade(),this._applyLang(this.get("language",null,0)),this._isMobileState()&&this.get("dbox_input").focus()},_openFade:function(){a(this._globalElems.fade).removeClass("m-select-d-box_hidden")},_closeFade:function(){a(this._globalElems.fade).addClass("m-select-d-box_hidden")},fx:{isTextInput:function(b){if(b instanceof Node==!1)return!1;var c=b.tagName.toLowerCase();if("input"==c){if(b.type&&a.inArray(b.type.toLowerCase(),["text","password","email","url","search","tel"])>-1)return!0}else if("textarea"==c)return!0;return!1},isHDensScreen:function(){return window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches)||window.devicePixelRatio&&window.devicePixelRatio>1.3||!1},isRetinaScreen:function(){return window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx), only screen and (min-resolution: 75.6dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min--moz-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2)").matches)||window.devicePixelRatio&&window.devicePixelRatio>=2||!1},msplit:function(a,b){return b=b.replace(new RegExp("["+a.join("")+"]","g"),a[0]),b.split(a[0])},trim:function(a,b,c){var d=[];return c&&"left"!=c||d.push("^["+b+"]+"),c&&"right"!=c||d.push("["+b+"]+$"),a.replace(new RegExp(d.join("|"),"g"),"")},rest:function(a,b){return"object"!=typeof a?[]:"number"!=typeof b?[]:Array.prototype.slice.call(a,b)},hop:function(a,b){return"hasOwnProperty"in a?Object.prototype.hasOwnProperty.call(a,b):b in a}}};var c=["open","close","isActive","get","set","select","selectAll","deselectAll","on","trigger","getSelectedLabels","getSelectedValues","getSelectedKeys","getText","setText"];a.fn.extend({mSelectDBox:function(d){if(this.length){for(var e=b.prototype.getInstances(),f=void 0,g=this[0],h=0;h<e.length;h++)if(e[h].get("target")==g){f=e[h];break}if(!arguments.length)return f;if("string"==typeof d){if(a.inArray(d,c)>-1){var i=b.prototype.fx.rest(arguments,1);if("function"==typeof f[d])return f[d].apply(f,i)}}else if("object"==typeof d)return d.target=this[0],new b(d)}}}),a.prototype.mSelectDBox.prototype=b.prototype}(jQuery);